\documentclass{article}
\usepackage[parfill]{parskip}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsthm} % for proofs
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{bm}
\usepackage[toc,page]{appendix}
\graphicspath{ {./images} }

\title{Matrix Inversion Lemma}
\author{Dávid Iván}

\begin{document}

\maketitle

\tableofcontents

\newpage

\section{$(I + UV)^{-1}$}

$I \in \mathbb{R}^{n\times n}$, $U \in \mathbb{R}^{n\times m}$, $V \in \mathbb{R}^{m\times n}$.

\begin{equation} \label{eq:I_UV}
    \boxed{(I_n + UV)^{-1} = I_n - U(I_m + VU)^{-1}V}
\end{equation}

\subsection{Proof.}

\begin{equation}
    A = I_n + UV
\end{equation}

\begin{equation}
    V A = V + VUV
\end{equation}

\begin{equation}
    V A = (I_m + VU)V
\end{equation}

\begin{equation}
    (I_m + VU)^{-1}V A = V
\end{equation}

\begin{equation}
    U(I_m + VU)^{-1}V A = UV
\end{equation}

\begin{equation}
    U(I_m + VU)^{-1}V A = A - I_n
\end{equation}

\begin{equation}
    U(I_m + VU)^{-1}V = I_n - A^{-1}
\end{equation}

\begin{equation}
    A^{-1} = I_n - U(I_m + VU)^{-1}V
\end{equation}



\section{$(R + PQP^T)^{-1}$}

$R \in \mathbb{R}^{n\times n}$ invertible, $P \in \mathbb{R}^{n\times m}$, $Q \in \mathbb{R}^{m\times m}$ invertible.

\begin{equation}
    \boxed{(R + PQP^T)^{-1} = R^{-1} - R^{-1} P (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1}}
\end{equation}

\subsection{Proof 1}

\begin{equation}
    A = R + PQP^T
\end{equation}

We want to find a formulae for $A^{-1}$.

\begin{equation}
    R^{-1}A = I + R^{-1}PQP^T
\end{equation}

\begin{equation}
    P^T R^{-1} A = P^T + P^T R^{-1}PQP^T
\end{equation}

\begin{equation}
    P^T R^{-1} A = (I + P^T R^{-1}PQ) P^T
\end{equation}

\begin{equation}
    P^T R^{-1} A = (Q^{-1} + P^T R^{-1}P) QP^T
\end{equation}

\begin{equation}
    (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1} A =  QP^T
\end{equation}

\begin{equation}
    P (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1} A =  PQP^T \equiv A - R
\end{equation}

\begin{equation}
    P (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1} A = A - R
\end{equation}

\begin{equation}
    R = A - P (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1} A
\end{equation}

\begin{equation}
    R = (I - P (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1}) A
\end{equation}

\begin{equation}
    R A^{-1} = I - P (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1}
\end{equation}

\begin{equation}
    A^{-1} = R^{-1} - R^{-1} P (Q^{-1} + P^T R^{-1}P)^{-1} P^T R^{-1}
\end{equation}

\subsection{Proof 2}

Here we use (\ref{eq:I_UV}).

\begin{equation}
    A = R + PQP^T = R (I + R^{-1} P Q P^T)
\end{equation}

\begin{equation}
    A^{-1} = (I + R^{-1} P Q P^T)^{-1} R^{-1}
\end{equation}

With $U=R^{-1}P$ and $V=QP^T$, we can write:

\begin{equation}
    A^{-1} = (I - R^{-1} P (I + Q P^T R^{-1} P)^{-1} Q P^T) R^{-1}
\end{equation}

\begin{equation}
    A^{-1} = (I - R^{-1} P (Q^{-1} + P^T R^{-1} P)^{-1} P^T) R^{-1}
\end{equation}

\begin{equation}
    A^{-1} = R^{-1} - R^{-1} P (Q^{-1} + P^T R^{-1} P)^{-1} P^T R^{-1}
\end{equation}


\end{document}